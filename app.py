import streamlit as st
from arabic_reshaper import reshape
from bidi.algorithm import get_display
from reportlab.pdfgen import canvas
from reportlab.pdfbase import pdfmetrics
from reportlab.pdfbase.ttfonts import TTFont
import io
import base64

def ar(text):
    return get_display(reshape(text))

def generate_pdf(data, answers):
    buffer = io.BytesIO()
    pdfmetrics.registerFont(TTFont("DejaVu", "DejaVuSans.ttf"))
    c = canvas.Canvas(buffer)
    c.setFont("DejaVu", 14)
    c.drawCentredString(300, 800, ar("ูุชูุฌุฉ ูุณุงุนุฏ ุชุฃุณูุณ ุดุฑูุฉ - ูููู ุฒูู"))
    y = 770

    c.drawString(50, y, ar("๐ง ุฅุฌุงุจุงุช ุงูุฃุณุฆูุฉ:"))
    y -= 25
    for q, a in answers.items():
        c.drawString(70, y, ar(f"- {q}: {a}"))
        y -= 20

    y -= 15
    c.drawString(50, y, ar("๐ ุชูุงุตูู ุงูุดุฑูุฉ:"))
    y -= 25
    for label, value in data.items():
        c.drawRightString(550, y, ar(f"{label}: {value}"))
        y -= 25

    c.save()
    buffer.seek(0)
    b64 = base64.b64encode(buffer.read()).decode()
    return f'<a href="data:application/pdf;base64,{b64}" download="ุชูุฑูุฑ_ุงูุดุฑูุฉ.pdf">๐ฅ ุชุญููู ุงูุชูุฑูุฑ PDF</a>'

st.set_page_config(page_title="ูุณุงุนุฏ ุชุฃุณูุณ ุดุฑูุฉ - ูููู ุฒูู", layout="centered")
st.title("๐ค ูุณุงุนุฏ ุชุฃุณูุณ ุดุฑูุฉ - ูููู ุฒูู")

with st.form("advisor_form"):
    st.markdown("### ๐ง ุฌุงูุจ ุนูู ุงูุฃุณุฆูุฉ ุงูุชุงููุฉ ุนูุดุงู ูุฑุดุญูู ููุน ุงูุดุฑูุฉ ุงูููุงุณุจ")
    q1 = st.radio("ูู ุฃูุช ูุญุฏู ูู ุงููุดุฑูุนุ", ["ูุนู", "ูุง"])
    q2 = st.radio("ูู ุชุฑุบุจ ูู ุญูุงูุฉ ุฃููุงูู ุงูุดุฎุตูุฉ ูู ุงููุฎุงุทุฑุ", ["ูุนู", "ูุง"])
    q3 = st.radio("ูู ูุนู ุดุฑูู ููุท ููุชูููู ุฏูู ุฅุฏุงุฑุฉุ", ["ูุนู", "ูุง"])
    q4 = st.radio("ูู ุชููู ุฏุฎูู ุงูุจูุฑุตุฉ ุฃู ุงูุงุณุชุซูุงุฑ ุงููุจูุฑุ", ["ูุนู", "ูุง"])
    q5 = st.radio("ูู ุงูููุงู ุชุงุจุน ูุดุฑูุฉ ุฃุฌูุจูุฉ ุจุงูุฎุงุฑุฌุ", ["ูุนู", "ูุง"])
    q6 = st.radio("ูู ุชุฑูุฏ ุงููุฑููุฉ ูู ุฏุฎูู ูุฎุฑูุฌ ุงูุดุฑูุงุกุ", ["ูุนู", "ูุง"])
    q7 = st.radio("ูู ุชุชููุน ุนุฏุฏ ุดุฑูุงุก ุฃูุซุฑ ูู 10 ุฃูุฑุงุฏุ", ["ูุนู", "ูุง"])

    st.markdown("### ๐ต ุจูุงูุงุช ุฑุฃุณ ุงููุงู")
    actual_capital = st.number_input("๐ฐ ุฑุฃุณ ุงููุงู ุงููุนูู (ุจุงูุฌููู)", min_value=0, step=1000)
    legal_capital = st.number_input("๐๏ธ ุฑุฃุณ ุงููุงู ูู ุงูุณุฌู ุงูุชุฌุงุฑู (ุจุงูุฌููู)", min_value=0, step=1000)

    st.markdown("### ๐ ุจูุงูุงุช ุงูุดุฑูุฉ")
    name = st.text_input("๐ ุงุณู ุงูุดุฑูุฉ")
    owner = st.text_input("๐ค ุงุณู ุงููุงูู")
    location = st.text_input("๐ ุงููุญุงูุธุฉ")
    partners = st.number_input("๐ฅ ุนุฏุฏ ุงูุดุฑูุงุก", min_value=1, step=1)

    submitted = st.form_submit_button("๐ ุงุนุฑู ููุน ุงูุดุฑูุฉ ูุงูุชูููุฉ")

deposit_info = "ูุง ููุฌุฏ ูุฏูุนุฉ ูุทููุจุฉ"

answers = {
    "ูู ุฃูุช ูุญุฏู ูู ุงููุดุฑูุนุ": q1,
    "ูู ุชุฑุบุจ ูู ุญูุงูุฉ ุฃููุงูู ุงูุดุฎุตูุฉ ูู ุงููุฎุงุทุฑุ": q2,
    "ูู ูุนู ุดุฑูู ููุท ููุชูููู ุฏูู ุฅุฏุงุฑุฉุ": q3,
    "ูู ุชููู ุฏุฎูู ุงูุจูุฑุตุฉ ุฃู ุงูุงุณุชุซูุงุฑ ุงููุจูุฑุ": q4,
    "ูู ุงูููุงู ุชุงุจุน ูุดุฑูุฉ ุฃุฌูุจูุฉ ุจุงูุฎุงุฑุฌุ": q5,
    "ูู ุชุฑูุฏ ุงููุฑููุฉ ูู ุฏุฎูู ูุฎุฑูุฌ ุงูุดุฑูุงุกุ": q6,
    "ูู ุชุชููุน ุนุฏุฏ ุดุฑูุงุก ุฃูุซุฑ ูู 10 ุฃูุฑุงุฏุ": q7
}

if submitted:
    company_type, notes, base_cost = "", "", 0
    duration = "ูู 15 ููู ุฅูู ุดูุฑ ุนูู"

    if q5 == "ูุนู":
        company_type = "ูุฑุน ุดุฑูุฉ ุฃุฌูุจูุฉ"
        notes = "ููุงุณุจ ูุฅูุดุงุก ูุฑุน ูุดุฑูุฉ ุจุงูุฎุงุฑุฌ ุฏุงุฎู ูุตุฑ"
        base_cost = 28000
        deposit_info = "ูุฏูุนุฉ 20000 ุฌููู ูุทููุจุฉ ุจุงุณู ุงูุดุฑูุฉ"
    elif q4 == "ูุนู" or q7 == "ูุนู":
        company_type = "ุดุฑูุฉ ูุณุงููุฉ"
        notes = "ููุงุณุจุฉ ูููุดุฑูุนุงุช ุงููุจูุฑุฉ ูุฏุฎูู ุงูุจูุฑุตุฉ"
        base_cost = 30000
        deposit_info = "ูุฏูุนุฉ 30000 ุฌููู ูุทููุจุฉ ุจุงุณู ุงูุดุฑูุฉ"
    elif q3 == "ูุนู":
        company_type = "ุดุฑูุฉ ุชูุตูุฉ ุจุณูุทุฉ"
        notes = "ุชูุงุณุจ ุดุฑุงูุฉ ูููุง ุดุฑูู ูููู ุบูุฑ ุฅุฏุงุฑู"
        base_cost = 17000
        deposit_info = "ูุฏูุนุฉ 10000 ุฌููู ูุทููุจุฉ ุจุงุณู ุงูุดุฑูุฉ"
    elif q1 == "ูุง" and q2 == "ูุนู":
        company_type = "ุดุฑูุฉ ุฐุงุช ูุณุคูููุฉ ูุญุฏูุฏุฉ"
        notes = "ููุงุณุจุฉ ูุญูุงูุฉ ูุงููููุฉ ูุฑูุฉ ูุชูููุฏ ุงููุณุคูููุฉ"
        base_cost = 22000
        deposit_info = "ูุฏูุนุฉ 15000 ุฌููู ูุทููุจุฉ ุจุงุณู ุงูุดุฑูุฉ"
    elif q1 == "ูุง" and q6 == "ูุง":
        company_type = "ุดุฑูุฉ ุชุถุงูู"
        notes = "ุดุฑุงูุฉ ูุชุณุงููุฉ ุจุงููุณุคูููุฉ ูุงูุฅุฏุงุฑุฉ"
        base_cost = 15000
        deposit_info = "ูุง ููุฌุฏ ูุฏูุนุฉ ูุทููุจุฉ"
    elif q1 == "ูุนู":
        company_type = "ููุดุฃุฉ ูุฑุฏูุฉ"
        notes = "ุชูุงุณุจ ูุดุฑูุน ูุฑุฏู ุจุณูุท ุจุงุณู ุดุฎุต ูุงุญุฏ"
        base_cost = 10000
        deposit_info = "ูุง ููุฌุฏ ูุฏูุนุฉ ูุทููุจุฉ"
    else:
        company_type = "ุดุฑูุฉ ุฐุงุช ูุณุคูููุฉ ูุญุฏูุฏุฉ"
        notes = "ุงุฎุชูุงุฑ ููุงุณุจ ููุญูุงูุฉ ุงููุงููููุฉ ูุงูุชูุธูู"
        base_cost = 22000
        deposit_info = "ูุฏูุนุฉ 15000 ุฌููู ูุทููุจุฉ ุจุงุณู ุงูุดุฑูุฉ"

    profit = 5000
    total_cost = base_cost + profit

    data = {
        "ุงุณู ุงูุดุฑูุฉ": name,
        "ุงููุงูู": owner,
        "ุงููููุน": location,
        "ุนุฏุฏ ุงูุดุฑูุงุก": partners,
        "ููุน ุงูุดุฑูุฉ ุงูููุชุฑุญุฉ": company_type,
        "๐ธ ุงูุชูููุฉ ุงูุฃุณุงุณูุฉ": f"{base_cost:,} ุฌููู",
        "๐ผ ุฃุชุนุงุจ ูููู ุฒูู": f"{profit:,} ุฌููู",
        "๐ฐ ุงูุฅุฌูุงูู": f"{total_cost:,} ุฌููู",
        "๐ฆ ุฑุฃุณ ุงููุงู ุงููุนูู": f"{actual_capital:,} ุฌููู",
        "๐ ุฑุฃุณ ุงููุงู ูู ุงูุณุฌู": f"{legal_capital:,} ุฌููู",
        "๐ ูุฏูุนุฉ ููุฆุฉ ุงูุงุณุชุซูุงุฑ": deposit_info,
        "โฑ๏ธ ุงููุฏุฉ ุงููุชููุนุฉ ููุชูููุฐ": duration,
        "๐ ููุงุญุธุงุช": notes
    }

    st.markdown("---")
    st.subheader("โ ุชูุงุตูู ุดุฑูุชู ุงูููุชุฑุญุฉ:")
    for k, v in data.items():
        st.write(f"**{k}:** {v}")
    st.markdown(generate_pdf(data, answers), unsafe_allow_html=True)
